---
title: PHP 中正确计算中文字数
id: 657
comment: false
categories:
  - 后端
date: 2016-02-08 14:12:26
tags:
  - PHP
---

在使用 PHP 开发网站或服务端的时候，经常需要限制用户输入信息的长度。

PHP 提供了 `strlen` 方法用于计算字符串的长度。早期一般用这个方法判断字数。
<!--more-->

``` php
echo strlen('早上好');
```

不过，这个方法计算的是字节数，而不是字符数（字数）。在 utf-8 编码下，一个汉字一般等于3个字节。所以用 `strlen` 计算“早上好”的长度，结果等于9。换言之，在使用 `strlen` 限制长度小于12的情况下，用户可以输入12个英文字母，或4个汉字。

以前解决这种问题一般使用更宽容的长度限制，如：预计让用户输入12个中文字符，则限制 `strlen($s)<=36` 。这又会导致用户能够输入36个英文字符。

最好的解决办法是使用新版 PHP（通过拓展）提供的 `mb_strlen` 方法，它可以忽略编码造成中英文字节数的差别，计算字符数，也就真正实现了计算字数。

``` php
echo mb_strlen( '早上好', 'utf-8');
```

用 `mb_strlen` 计算“早上好”的长度，结果为3。