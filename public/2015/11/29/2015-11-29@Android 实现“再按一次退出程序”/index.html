<html>
  <head>
    <title>ym</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/app.css">
  <meta name="generator" content="Hexo 4.2.1"></head>
  <body>
    <div class="head">
      <div class="header">
        <a href="/ ">
          <div class="site-title">YM</div>
        </a>
      </div>
    </div>
    <div class="body">
      <div class="content">
        Android 实现“再按一次退出程序” 
<p>我们经常会在 APP 中看到用连按两次返回键来退出应用的设计。</p>
<p>通常，用户在打开应用的首个 Activity 上按下返回键，得到类似“再按一次退出程序”的短提示，用户再次按下返回键，应用退出。</p>
<a id="more"></a>

<p>这样的设计，一方面尊重了用户长期以来自发形成的操作习惯、使得退出应用更加简便，另一方面节省了视图空间，界面上无需提供一个退出按钮。</p>
<p>实际上要实现按两次返回键退出应用是很容易的。Activity 中有一个 <code>onKeyUp</code> 方法用来监听按键事件，覆写这个方法并添加对返回键的处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该变量用于存储上一次按键时间</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> mFirstTime = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKeyUp</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span>(keyCode) &#123;  </span><br><span class="line">    <span class="keyword">case</span> KeyEvent.KEYCODE_BACK :</span><br><span class="line">      <span class="keyword">long</span> mSecondTime = System.currentTimeMillis();   </span><br><span class="line">      <span class="comment">// 当按键间隔大于2秒时弹出提示</span></span><br><span class="line">      <span class="keyword">if</span> ( mSecondTime - mFirstTime &gt; <span class="number">2000</span>) &#123;  </span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"再按一次退出程序"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        <span class="comment">// 更新上一次按键时间</span></span><br><span class="line">        mFirstTime = mSecondTime; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 当按键间隔小于2秒时退出程序</span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        System.exit(<span class="number">0</span>);</span><br><span class="line">      &#125;   </span><br><span class="line">      <span class="keyword">break</span>;  </span><br><span class="line">  &#125;  </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">super</span>.onKeyUp(keyCode, event); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当用户第一次按下返回键，两个变量之差显然大于2000毫秒，应用弹出“再按一次退出程序”提示并将当前时间（即 mSecondTime 的值）赋予 mFirstTime 。</p>
<p>当用户第二次按下返回键，如果两次按键时间小于2000毫秒，应用退出；如果两次按键时间大于2000毫秒，再次弹出提示并更新 mFirstTime 。</p>
 
      </div>
    </div>
    <div class="foot">
      <div class="footer">
        <span class="copyright">©️2020 ym</span>
        <a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20041235 </a>
      </div>
    </div>
  </body>
</html>