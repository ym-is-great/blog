<html>
  <head>
    <title>ym</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/app.css">
  <meta name="generator" content="Hexo 4.2.1"></head>
  <body>
    <div class="head">
      <div class="header">
        <a href="/ ">
          <div class="site-title">YM</div>
        </a>
      </div>
    </div>
    <div class="body">
      <div class="content">
        解决 iOS 下日期对象 Invalid Date 错误 
<p>JavaScript 中的 Date 对象用于处理日期和时间，对前端开发而言几乎是每天都要打交道的一个东西，但它存在着一个奇葩、不易被注意到的兼容性问题。这是今天在处理产品经理提出的 bug 时偶然发现的。</p>
<a id="more"></a>


<p>下面这行简单的代码，仅仅用于定义一个日期对象。它在 iOS 下可能无法正确执行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2017-09-28'</span>) <span class="comment">// Windows、Android 返回日期对象，iOS 返回 Invalid Date 。</span></span><br></pre></td></tr></table></figure>

<p>在 iOS 环境下（先后使用 iPhone6、iPhone6 Plus 测试），这行代码始终返回 Invalid Date（无效的日期）。很显然，系统不能正确解析 <code>2017-09-28</code> 这个日期字符串。</p>
<p>解决方法也非常简单，换一种 iOS 能够解析的日期格式即可，使用 <code>/</code> 代替日期字符串中的 <code>-</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2017/09/28'</span>)</span><br></pre></td></tr></table></figure>

<p>由于存储在数据库中的日期通常使用 <code>-</code> 分隔年月日，为避免出现兼容问题，前端渲染时应该默认使用 <code>replace</code> 方法批量替换。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">'2017-09-28'</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(str.replace(<span class="regexp">/-/g</span>, <span class="string">'/'</span>))</span><br></pre></td></tr></table></figure> 
      </div>
    </div>
    <div class="foot">
      <div class="footer">
        <span class="copyright">©️2020 ym</span>
        <a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20041235 </a>
      </div>
    </div>
  </body>
</html>