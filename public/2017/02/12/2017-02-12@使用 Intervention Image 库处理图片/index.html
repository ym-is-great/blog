<html>
  <head>
    <title>ym</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/app.css">
  <meta name="generator" content="Hexo 4.2.1"></head>
  <body>
    <div class="head">
      <div class="header">
        <a href="/ ">
          <div class="site-title">YM</div>
        </a>
      </div>
    </div>
    <div class="body">
      <div class="content">
        使用 Intervention Image 库处理图片 
<p>Intervention Image 是一个开源图片处理库。使用它需要 PHP&gt;=5.4、FileInfo 拓展、GD 库或 Imagick 拓展。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>执行以下命令使用 Composer 安装 Intervention Image 的最新版本。</p>
<a id="more"></a>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require intervention/image</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>Intervention Image 并不依赖于 Laravel 或其他框架，使用时只需包含 Composer 的 autoload 文件，然后实例化 Image 对象。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 包含autoload文件</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入ImageManager类</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Intervention</span>\<span class="title">Image</span>\<span class="title">ImageManager</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建ImageManager实例并指定要使用的驱动(默认GD库)</span></span><br><span class="line">$manager = <span class="keyword">new</span> ImageManager(<span class="keyword">array</span>(<span class="string">'driver'</span> =&gt; <span class="string">'imagick'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Image实例然后操作图片</span></span><br><span class="line">$image = $manager-&gt;make(<span class="string">'public/foo.jpg'</span>)-&gt;resize(<span class="number">300</span>, <span class="number">200</span>);</span><br></pre></td></tr></table></figure>

<p>也可以在导入类时设置一个别名。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 包含autoload文件</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入ImageManager类</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Intervention</span>\<span class="title">Image</span>\<span class="title">ImageManagerStatic</span> <span class="title">as</span> <span class="title">Image</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建ImageManager实例并指定要使用的驱动(默认GD库)</span></span><br><span class="line">Image::configure(<span class="keyword">array</span>(<span class="string">'driver'</span> =&gt; <span class="string">'imagick'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Image实例然后操作图片</span></span><br><span class="line">$image = Image::make(<span class="string">'public/foo.jpg'</span>)-&gt;resize(<span class="number">300</span>, <span class="number">200</span>);</span><br></pre></td></tr></table></figure>

<h3 id="在-Laravel-中使用"><a href="#在-Laravel-中使用" class="headerlink" title="在 Laravel 中使用"></a>在 Laravel 中使用</h3><p>Intervention Image 提供了服务提供者、门面以便快速集成到 Laravel 框架。</p>
<p>打开 Laravel 的配置文件 <code>config\app.php</code> ，在 <code>$providers</code> 数组中添加一个服务提供者。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Intervention\Image\ImageServiceProvider::class</span><br></pre></td></tr></table></figure>
<p>在 <code>$aliases</code> 数组中添加一个门面。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'Image'</span> =&gt; Intervention\Image\Facades\Image::class</span><br></pre></td></tr></table></figure>

<p>Intervention Image 默认使用 GD 库处理图片，如果需要切换到 Imagick ，执行以下命令创建配置文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --provider=<span class="string">"Intervention\Image\ImageServiceProviderLaravel5"</span></span><br></pre></td></tr></table></figure>

<h3 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个Image对象</span></span><br><span class="line">$img = Image::make(<span class="string">'public/foo.jpg'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取图片文件大小</span></span><br><span class="line">$size = $img-&gt;filesize();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取图片尺寸（像素）</span></span><br><span class="line">$width  = $img-&gt;width();</span><br><span class="line">$height = $img-&gt;height();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调整图片尺寸</span></span><br><span class="line">$img-&gt;resize(<span class="number">300</span>, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调整图片的宽或高</span></span><br><span class="line">$img-&gt;resize(<span class="number">300</span>, <span class="keyword">null</span>);</span><br><span class="line">$img-&gt;resize(<span class="keyword">null</span>, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调整图片的宽同时保持图片比例</span></span><br><span class="line">$img-&gt;resize(<span class="number">300</span>, <span class="keyword">null</span>, <span class="function"><span class="keyword">function</span> <span class="params">($constraint)</span> </span>&#123;</span><br><span class="line">    $constraint-&gt;aspectRatio();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调整图片的高同时保持图片比例</span></span><br><span class="line">$img-&gt;resize(<span class="keyword">null</span>, <span class="number">200</span>, <span class="function"><span class="keyword">function</span> <span class="params">($constraint)</span> </span>&#123;</span><br><span class="line">    $constraint-&gt;aspectRatio();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 避免处理时造成文件大小增加</span></span><br><span class="line">$img-&gt;resize(<span class="keyword">null</span>, <span class="number">400</span>, <span class="function"><span class="keyword">function</span> <span class="params">($constraint)</span> </span>&#123;</span><br><span class="line">    $constraint-&gt;aspectRatio();</span><br><span class="line">    $constraint-&gt;upsize();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转码为其他格式并压缩图片</span></span><br><span class="line">$img-&gt;encode(<span class="string">'jpg'</span>, <span class="number">75</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转码为 Data URL</span></span><br><span class="line">$img-&gt;encode(<span class="string">'data-url'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 裁剪图片</span></span><br><span class="line">$img-&gt;crop(<span class="number">100</span>, <span class="number">100</span>, <span class="number">25</span>, <span class="number">25</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旋转-45度</span></span><br><span class="line">$img-&gt;rotate(<span class="number">-45</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 垂直翻转及水平翻转</span></span><br><span class="line">$img-&gt;flip(<span class="string">'v'</span>);</span><br><span class="line">$img-&gt;flip(<span class="string">'h'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以最优方案裁剪为600*360</span></span><br><span class="line">$img-&gt;fit(<span class="number">600</span>, <span class="number">360</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以最优方案裁剪为200*200</span></span><br><span class="line">$img-&gt;fit(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以默认质量保存图片</span></span><br><span class="line">$img-&gt;save(<span class="string">'public/bar.jpg'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以给定质量保存图片</span></span><br><span class="line">$img-&gt;save(<span class="string">'public/bar.png'</span>, <span class="number">60</span>);</span><br></pre></td></tr></table></figure>

<p>我只记录了部分常用的接口，更多 API 及其用法可以 <a href="http://image.intervention.io/" target="_blank" rel="noopener">阅读</a> 官方文档了解。</p>
<p>相关环境：Windows 7 x64 / VirtualBox 5.1.8 / Laravel Homestead / Laravel 5.3</p>
 
      </div>
    </div>
    <div class="foot">
      <div class="footer">
        <span class="copyright">©️2020 ym</span>
        <a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20041235 </a>
      </div>
    </div>
  </body>
</html>