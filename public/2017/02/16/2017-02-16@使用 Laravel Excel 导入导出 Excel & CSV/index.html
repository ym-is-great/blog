<html>
  <head>
    <title>ym</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/app.css">
  <meta name="generator" content="Hexo 4.2.1"></head>
  <body>
    <div class="head">
      <div class="header">
        <a href="/ ">
          <div class="site-title">YM</div>
        </a>
      </div>
    </div>
    <div class="body">
      <div class="content">
        使用 Laravel Excel 导入导出 Excel & CSV 
<p>Laravel Excel 是一个开源库，使用它可以很轻易地在 Laravel 项目上实现导入和导出 Excel、CSV 文件。Laravel Excel 基于另一个开源项目 PHPExcel ，所以如果你的应用不是运行在 Laravel 上， 你也可以尝试使用 PHPExcel 。</p>
<a id="more"></a>

<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>在 composer.json 中添加相应的包。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"maatwebsite/excel"</span>: <span class="string">"~2.1.0"</span></span><br></pre></td></tr></table></figure>
<p>然后在命令行执行以下代码安装 Laravel Excel 。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer update</span><br></pre></td></tr></table></figure>
<p>修改 Laravel 的配置文件 config/app.php ，在 $providers 数组中添加一个服务提供者。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'Maatwebsite\Excel\ExcelServiceProvider'</span></span><br></pre></td></tr></table></figure>
<p>接着在 $aliasses 数组中添加一个门面。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'Excel'</span> =&gt; <span class="string">'Maatwebsite\Excel\Facades\Excel'</span></span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>如果你想要查看或者修改 Laravel Excel 提供的配置，在命令行执行以下代码，然后你就会在 config 文件夹下得到一个配置文件。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>在控制器中引用这个包。如果之前已经添加过门面，也可以直接引用门面。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Maatwebsite</span>\<span class="title">Excel</span>\<span class="title">Facades</span>\<span class="title">Excel</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Excel</span>;</span><br></pre></td></tr></table></figure>

<h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载文件</span></span><br><span class="line">Excel::load(<span class="string">'file.xls'</span>, <span class="function"><span class="keyword">function</span><span class="params">($reader)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取数据的集合</span></span><br><span class="line">  $results = $reader-&gt;get();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取第一行数据</span></span><br><span class="line">  $results = $reader-&gt;first();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取前10行数据</span></span><br><span class="line">  $reader-&gt;take(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 跳过前10行数据</span></span><br><span class="line">  $reader-&gt;skip(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 以数组形式获取数据</span></span><br><span class="line">  $reader-&gt;toArray();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 打印数据</span></span><br><span class="line">  $reader-&gt;dump();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 遍历工作表</span></span><br><span class="line">  $reader-&gt;each(<span class="function"><span class="keyword">function</span><span class="params">($sheet)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历行</span></span><br><span class="line">    $sheet-&gt;each(<span class="function"><span class="keyword">function</span><span class="params">($row)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取指定的列</span></span><br><span class="line">  $reader-&gt;select(<span class="keyword">array</span>(<span class="string">'firstname'</span>, <span class="string">'lastname'</span>))-&gt;get();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取指定的列</span></span><br><span class="line">  $reader-&gt;get(<span class="keyword">array</span>(<span class="string">'firstname'</span>, <span class="string">'lastname'</span>));</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 选择名为sheet1的工作表</span></span><br><span class="line">Excel::selectSheets(<span class="string">'sheet1'</span>)-&gt;load();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据索引选择工作表</span></span><br><span class="line">Excel::selectSheetsByIndex(<span class="number">0</span>)-&gt;load();</span><br></pre></td></tr></table></figure>

<h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成文件</span></span><br><span class="line">Excel::create(<span class="string">'Filename'</span>, <span class="function"><span class="keyword">function</span><span class="params">($excel)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置文档标题和作者</span></span><br><span class="line">  $excel-&gt;setTitle(<span class="string">'Our new awesome title'</span>);</span><br><span class="line">  $excel-&gt;setCreator(<span class="string">'Maatwebsite'</span>)</span><br><span class="line">    -&gt;setCompany(<span class="string">'Maatwebsite'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置文档描述</span></span><br><span class="line">  $excel-&gt;setDescription(<span class="string">'A demonstration to change the file properties'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建工作表</span></span><br><span class="line">  $excel-&gt;sheet(<span class="string">'Sheetname'</span>, <span class="function"><span class="keyword">function</span><span class="params">($sheet)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过数组写入值（二维数组）</span></span><br><span class="line">    $sheet-&gt;fromArray($array);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给第一行写入值（一维数组）</span></span><br><span class="line">    $sheet-&gt;row(<span class="number">1</span>, $array);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置某一列的宽</span></span><br><span class="line">    $sheet-&gt;setWidth(<span class="string">'A'</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 批量设置列宽</span></span><br><span class="line">    $sheet-&gt;setWidth([</span><br><span class="line">        <span class="string">'A'</span> =&gt; <span class="number">5</span>,</span><br><span class="line">        <span class="string">'B'</span> =&gt; <span class="number">10</span></span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成为指定的格式并下载</span></span><br><span class="line">Excel::create()-&gt;export(<span class="string">'xls'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成为指定的格式并存储在app/storage/exports目录</span></span><br><span class="line">Excel::create()-&gt;store(<span class="string">'xls'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成为指定的格式并存储在指定的目录</span></span><br><span class="line">Excel::create()-&gt;store(<span class="string">'xls'</span>, storage_path(<span class="string">'excel/exports'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储后返回文件数据（包含路径等）</span></span><br><span class="line">Excel::create()-&gt;store(<span class="string">'xls'</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>Laravel Excel 还提供了很多包含表格样式修改在内的其他 API 。感兴趣的话可以阅读 <a href="http://www.maatwebsite.nl/laravel-excel/docs" target="_blank" rel="noopener">官方文档</a> 了解。</p>
<p>相关环境：Windows 7 x64 / VirtualBox 5.1.8 / Laravel Homestead / Laravel 5.3</p>
 
      </div>
    </div>
    <div class="foot">
      <div class="footer">
        <span class="copyright">©️2020 ym</span>
        <a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20041235 </a>
      </div>
    </div>
  </body>
</html>