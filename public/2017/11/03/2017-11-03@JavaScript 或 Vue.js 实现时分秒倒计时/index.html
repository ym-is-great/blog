<html>
  <head>
    <title>ym</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/app.css">
  <meta name="generator" content="Hexo 4.2.1"></head>
  <body>
    <div class="head">
      <div class="header">
        <a href="/ ">
          <div class="site-title">YM</div>
        </a>
      </div>
    </div>
    <div class="body">
      <div class="content">
        JavaScript / Vue.js 实现时分秒倒计时 
<p>我们平常浏览网页的时候，经常见到“距游戏公测1天2小时3分钟4秒”这样的倒计时器。时间如沙漏般一点点的减少，不仅能挑起用户的兴趣，而且让页面提升了一点逼格，还填补掉一些尴尬的空白位置。最近写得越来越多，有用没用都让加个倒计时，干脆记录下来，免得重复造轮子。</p>
<a id="more"></a>


<p>实现的方法并不复杂，关键是理解如何计算，尤其对我这种数学不好的人而言。下面两个 demo 将分别用纯 JavaScript 、基于 Vue.js 的 JavaScript 实现。注，代码中可能包含部分 ES6 语法，但相信很容易理解。</p>
<h3 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h3><p>创建一个 <code>countdown</code> 方法，用于计算并在控制台打印距目标时间的日、时、分、秒数，每隔一秒递归执行一次。</p>
<p><code>msec</code> 是当前时间距目标时间的毫秒数，由时间戳相减得到，我们将以这个数为基础计算。我们都知道1天等于24小时，1小时等于60分钟，1分钟等于60秒，1秒等于1000毫秒。所以，<code>msec / 1000 / 60 / 60 / 24</code> 保留整数就是天数。如果换用 <code>%</code> 取余数，再保留整数后得到的就是小时数。以此类推就能算出其他所有数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">countdown</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 目标日期时间戳</span></span><br><span class="line">  <span class="keyword">const</span> end = <span class="built_in">Date</span>.parse(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2017-12-01'</span>))</span><br><span class="line">  <span class="comment">// 当前时间戳</span></span><br><span class="line">  <span class="keyword">const</span> now = <span class="built_in">Date</span>.parse(<span class="keyword">new</span> <span class="built_in">Date</span>())</span><br><span class="line">  <span class="comment">// 相差的毫秒数</span></span><br><span class="line">  <span class="keyword">const</span> msec = end - now</span><br><span class="line">  <span class="comment">// 计算时分秒数</span></span><br><span class="line">  <span class="keyword">let</span> day = <span class="built_in">parseInt</span>(msec / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> / <span class="number">24</span>)</span><br><span class="line">  <span class="keyword">let</span> hr = <span class="built_in">parseInt</span>(msec / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> % <span class="number">24</span>)</span><br><span class="line">  <span class="keyword">let</span> min = <span class="built_in">parseInt</span>(msec / <span class="number">1000</span> / <span class="number">60</span> % <span class="number">60</span>)</span><br><span class="line">  <span class="keyword">let</span> sec = <span class="built_in">parseInt</span>(msec / <span class="number">1000</span> % <span class="number">60</span>)</span><br><span class="line">  <span class="comment">// 个位数前补零</span></span><br><span class="line">  hr = hr &gt; <span class="number">9</span> ? hr : <span class="string">'0'</span> + hr</span><br><span class="line">  min = min &gt; <span class="number">9</span> ? min : <span class="string">'0'</span> + min</span><br><span class="line">  sec = sec &gt; <span class="number">9</span> ? sec : <span class="string">'0'</span> + sec</span><br><span class="line">  <span class="comment">// 控制台打印</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;day&#125;</span>天 <span class="subst">$&#123;hr&#125;</span>小时 <span class="subst">$&#123;min&#125;</span>分钟 <span class="subst">$&#123;sec&#125;</span>秒`</span>)</span><br><span class="line">  <span class="comment">// 一秒后递归</span></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    countdown()</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制台打印结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">27天 07小时 49分钟 10秒</span><br><span class="line">27天 07小时 49分钟 09秒</span><br><span class="line">27天 07小时 49分钟 08秒</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="Vue-js"><a href="#Vue-js" class="headerlink" title="Vue.js"></a>Vue.js</h3><p>如果单纯使用 JavaScript ，我们需要在每次计算后手动更新 DOM 元素（将数据显示给用户），既不方便又难以维护。实际项目中更多的是配合前端框架，将计算结果实时渲染到页面上。</p>
<p>页面结构中的数据来自 Vue 实例的 <code>data</code> 对象。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span>&#123;&#123; `$&#123;day&#125;天 $&#123;hr&#125;小时 $&#123;min&#125;分钟 $&#123;sec&#125;分钟` &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>mounted</code> 是 Vue 的生命周期方法，可以理解为在页面加载完毕后执行 <code>countdown</code> 方法。<code>countdown</code> 方法每隔一秒会执行一次，并将计算结果分别赋予变量 <code>day</code>、<code>hr</code>、<code>min</code>、<code>sec</code>，同时改变的还有页面上显示的内容。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      day: <span class="number">0</span>, <span class="attr">hr</span>: <span class="number">0</span>, <span class="attr">min</span>: <span class="number">0</span>, <span class="attr">sec</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.countdown()</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    countdown: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> end = <span class="built_in">Date</span>.parse(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2017-12-01'</span>))</span><br><span class="line">      <span class="keyword">const</span> now = <span class="built_in">Date</span>.parse(<span class="keyword">new</span> <span class="built_in">Date</span>())</span><br><span class="line">      <span class="keyword">const</span> msec = end - now</span><br><span class="line">      <span class="keyword">let</span> day = <span class="built_in">parseInt</span>(msec / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> / <span class="number">24</span>)</span><br><span class="line">      <span class="keyword">let</span> hr = <span class="built_in">parseInt</span>(msec / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> % <span class="number">24</span>)</span><br><span class="line">      <span class="keyword">let</span> min = <span class="built_in">parseInt</span>(msec / <span class="number">1000</span> / <span class="number">60</span> % <span class="number">60</span>)</span><br><span class="line">      <span class="keyword">let</span> sec = <span class="built_in">parseInt</span>(msec / <span class="number">1000</span> % <span class="number">60</span>)</span><br><span class="line">      <span class="keyword">this</span>.day = day</span><br><span class="line">      <span class="keyword">this</span>.hr = hr &gt; <span class="number">9</span> ? hr : <span class="string">'0'</span> + hr</span><br><span class="line">      <span class="keyword">this</span>.min = min &gt; <span class="number">9</span> ? min : <span class="string">'0'</span> + min</span><br><span class="line">      <span class="keyword">this</span>.sec = sec &gt; <span class="number">9</span> ? sec : <span class="string">'0'</span> + sec</span><br><span class="line">      <span class="keyword">const</span> that = <span class="keyword">this</span></span><br><span class="line">      setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        that.countdown()</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>相关环境：Windows 7 x64 / Vue.js 2.4.4</p>
 
      </div>
    </div>
    <div class="foot">
      <div class="footer">
        <span class="copyright">©️2020 ym</span>
        <a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20041235 </a>
      </div>
    </div>
  </body>
</html>