<html>
  <head>
    <title>ym</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/app.css">
  <meta name="generator" content="Hexo 4.2.1"></head>
  <body>
    <div class="head">
      <div class="header">
        <a href="/ ">
          <div class="site-title">YM</div>
        </a>
      </div>
    </div>
    <div class="body">
      <div class="content">
        gulp 小教程 
<p>gulp 是一个前端代码 <strong>自动化</strong> 构建工具，帮助我们从令人痛苦或耗时的重复工作中解脱出来。用通俗易懂的话来说，gulp 能够帮你：拷贝资源文件、合并与压缩 JavaScript / CSS 文件、编译 CSS 预处理语言（Sass / Less）、监视文件的变化。</p>
<a id="more"></a>

<blockquote><p>友情提示：gulp [ɡʌlp] 的读音应该是“尬噗”，而不是“顾噗”。</p>
</blockquote>

<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>这玩意儿有用么？刚接触 gulp 的时候我也感到十分费解，觉得它能做的事我动动手指也搞得定。</p>
<p>虽然这些功能看似简单，但当你管理的文件越来越多，项目越来越多的时候，你就会不时忘记做这些“简单的小事”，甚至被它们干扰思路、影响心情。所以，该由机器做的事就交给机器吧，你只需敲一行命令，琐碎的工作就能完成。</p>
<p>使用 gulp 或类似的工具之后，变化或许是这样的：</p>
<img src="/images/posts/2017/05/gulp_efficiency.png" class="" width="480" title="耗费时间的结构变化">

<p>至于省下的时间用来干嘛，自己看着办咯。 : )</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>确认电脑上已安装 <a href="https://nodejs.org/" target="_blank" rel="noopener">Node.js</a> 。在命令行工具中执行以下命令，全局安装 gulp-cli（gulp 命令行接口）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --global gulp-cli</span><br></pre></td></tr></table></figure>

<p>然后在项目中安装 gulp （作为开发环境的依赖模块）。当然，也可以在新建的目录中安装，gulp 将正常工作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev gulp</span><br></pre></td></tr></table></figure>

<p>注意，目录下必须存在 <code>package.json</code> 文件，否则 npm 安装时可能出错。若不存在就新建一个，内容为空对象即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建第一个任务"><a href="#创建第一个任务" class="headerlink" title="创建第一个任务"></a>创建第一个任务</h3><p>在项目的根目录下新建 gulpfile.js 文件。它是 gulp 的配置文件，任何你希望 gulp 完成的工作都写在这份文档中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gulpfile.js</span></span><br><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 任务内容...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>task</code> 方法声明了一个名为 default 的空任务。在命令行中运行这个任务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp default</span><br></pre></td></tr></table></figure>

<p>通过输出的日志能够知道，default 任务已运行完毕。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[23:39:25] Using gulpfile E:\Code\gulp-test\gulpfile.js</span><br><span class="line">[23:39:25] Starting <span class="string">'default'</span>...</span><br><span class="line">[23:39:25] Finished <span class="string">'default'</span> after 78 μs</span><br></pre></td></tr></table></figure>

<h3 id="拷贝文件"><a href="#拷贝文件" class="headerlink" title="拷贝文件"></a>拷贝文件</h3><p>假设项目中存在以下2个存放图片的目录。为了用户能够正常加载图片，需要将第一个目录下的图片拷贝到第二个目录下。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">resources\assets\img</span>  <span class="comment"># 用户不可访问（开发环境使用）</span></span><br><span class="line"><span class="string">public\assets\img</span>     <span class="comment"># 用户可以访问（生产环境使用）</span></span><br></pre></td></tr></table></figure>

<p>编辑任务，实现简单的文件拷贝。<code>src</code> 方法用于指定文件来源，<code>pipe</code> 方法用于输送文件，<code>dest</code> 方法用于写文件。<code>dest</code> 方法的参数为输出目录。显而易见，这段代码的作用是将第一个目录中的 example.jpg 拷贝到第二个目录下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 仅拷贝图片 example.jpg</span></span><br><span class="line">  gulp.src(<span class="string">'resources/assets/img/example.jpg'</span>)</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'public/assets/img/'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行任务，在 public\assets\img 目录下可以看见刚拷贝过来的 example.jpg 。</p>
<p>如果要拷贝的图片非常多呢？使用 <code>**</code> 或 <code>*.jpg</code> 匹配目录下的全部或一整批图片。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拷贝全部文件</span></span><br><span class="line">gulp.src(<span class="string">'resources/assets/img/**'</span>)</span><br><span class="line">  .pipe(gulp.dest(<span class="string">'public/assets/img/'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拷贝所有 jpg 文件</span></span><br><span class="line">gulp.src(<span class="string">'resources/assets/img/*.jpg'</span>)</span><br><span class="line">  .pipe(gulp.dest(<span class="string">'public/assets/img/'</span>));</span><br></pre></td></tr></table></figure>

<h3 id="监视文件"><a href="#监视文件" class="headerlink" title="监视文件"></a>监视文件</h3><p>你可能会发出这样的疑问：总不能每次修改过图片都要 <code>gulp default</code> 一次吧？当然不能，gulp 存在的意义就是让我们省去简单重复的劳动。</p>
<p>使用 <code>watch</code> 方法监视目录的变化，当目录中的图片发生改变时运行 default 任务（拷贝图片）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监视目录</span></span><br><span class="line"><span class="keyword">var</span> watcher = gulp.watch(<span class="string">'resources/assets/img/**'</span>);</span><br><span class="line"></span><br><span class="line">watcher.on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 在发生变化时做一些事...</span></span><br><span class="line">  gulp.start(<span class="string">'default'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后运行 <code>gulp</code> 命令（执行配置文件的全部内容），gulp 会在运行一次 default 任务后开始监视目录，直到用 Ctrl+C 停止它。</p>
<p>通常应该单独创建监视任务，然后执行 <code>gulp watch</code> 运行它。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">'watch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> watcher = gulp.watch(<span class="string">'resources/assets/img/**'</span>);</span><br><span class="line">  watcher.on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    gulp.start(<span class="string">'default'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="压缩-JavaScript"><a href="#压缩-JavaScript" class="headerlink" title="压缩 JavaScript"></a>压缩 JavaScript</h3><p>假设项目中存在以下2个存放脚本的目录。为了节约用户的流量和时间，我们希望在第二个目录中生成压缩过的 js 文件。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">resources\assets\js</span>  <span class="comment"># 用户不可访问（开发环境使用）</span></span><br><span class="line"><span class="string">public\assets\js</span>     <span class="comment"># 用户可以访问（生产环境使用）</span></span><br></pre></td></tr></table></figure>

<p>安装 gulp-uglify 模块，用于压缩 JavaScript 文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev gulp-uglify</span><br></pre></td></tr></table></figure>

<p>使用 <code>uglify</code> 方法压缩 js 文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载 gulp-uglify 模块</span></span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  gulp.src(<span class="string">'resources/assets/js/**'</span>)</span><br><span class="line">    .pipe(uglify())  <span class="comment">// 压缩 JavaScript</span></span><br><span class="line">    .pipe(gulp.dest(<span class="string">'public/assets/js/'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="压缩-CSS"><a href="#压缩-CSS" class="headerlink" title="压缩 CSS"></a>压缩 CSS</h3><p>假设项目中存在以下2个存放样式的目录。同样的，我们要在第二个目录中生成压缩过的 css 文件。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">resources\assets\css</span>  <span class="comment"># 用户不可访问（开发环境使用）</span></span><br><span class="line"><span class="string">public\assets\css</span>     <span class="comment"># 用户可以访问（生产环境使用）</span></span><br></pre></td></tr></table></figure>

<p>安装 gulp-clean-css 模块，用于压缩 CSS 文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-clean-css --save-dev</span><br></pre></td></tr></table></figure>

<p>使用 <code>cleanCSS</code> 方法压缩 css 文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载 gulp-clean-css 模块</span></span><br><span class="line"><span class="keyword">var</span> cleanCSS = <span class="built_in">require</span>(<span class="string">'gulp-clean-css'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  gulp.src(<span class="string">'resources/assets/css/**'</span>)</span><br><span class="line">    .pipe(cleanCSS())  <span class="comment">// 压缩 CSS</span></span><br><span class="line">    .pipe(gulp.dest(<span class="string">'public/assets/css/'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="编译-Sass"><a href="#编译-Sass" class="headerlink" title="编译 Sass"></a>编译 Sass</h3><p>安装 gulp-sass 模块，用于将 scss 文件编译成 css 文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-sass --save-dev</span><br></pre></td></tr></table></figure>

<p>使用 <code>sass</code> 方法编译 scss 文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载 gulp-sass 模块</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sass = <span class="built_in">require</span>(<span class="string">'gulp-sass'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  gulp.src(<span class="string">'resources/assets/scss/**'</span>)</span><br><span class="line">    .pipe(sass())  <span class="comment">// 编译 Sass</span></span><br><span class="line">    .pipe(gulp.dest(<span class="string">'public/assets/css/'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="编译-Less"><a href="#编译-Less" class="headerlink" title="编译 Less"></a>编译 Less</h3><p>安装 gulp-less 模块，用于将 less 文件编译成 css 文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install gulp-less</span><br></pre></td></tr></table></figure>

<p>使用 <code>less</code> 方法编译 scss 文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载 gulp-less 模块</span></span><br><span class="line"><span class="keyword">var</span> less = <span class="built_in">require</span>(<span class="string">'gulp-less'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  gulp.src(<span class="string">'resources/assets/less/**'</span>)</span><br><span class="line">    .pipe(less())  <span class="comment">// 编译 less</span></span><br><span class="line">    .pipe(gulp.dest(<span class="string">'public/assets/css/'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="合并文件"><a href="#合并文件" class="headerlink" title="合并文件"></a>合并文件</h3><p>安装 gulp-concat 模块，用于合并 JavaScript/CSS 文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev gulp-concat</span><br></pre></td></tr></table></figure>

<p>使用 <code>concat</code> 方法合并文件，唯一的参数用于设置合并后的文件名。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载 gulp-concat 模块</span></span><br><span class="line"><span class="keyword">var</span> concat = <span class="built_in">require</span>(<span class="string">'gulp-concat'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  gulp.src(<span class="string">'resources/assets/js/**'</span>)</span><br><span class="line">    .pipe(concat(<span class="string">'main.js'</span>))  <span class="comment">// 合并 js</span></span><br><span class="line">    .pipe(gulp.dest(<span class="string">'public/assets/js/'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>相关环境：Windows 7 x64 / Node.js 6.10.1 / npm 3.10.10 / gulp 3.9.1</p>
 
      </div>
    </div>
    <div class="foot">
      <div class="footer">
        <span class="copyright">©️2020 ym</span>
        <a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20041235 </a>
      </div>
    </div>
  </body>
</html>