<html>
  <head>
    <title>ym</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/app.css">
  <meta name="generator" content="Hexo 4.2.1"></head>
  <body>
    <div class="head">
      <div class="header">
        <a href="/ ">
          <div class="site-title">YM</div>
        </a>
      </div>
    </div>
    <div class="body">
      <div class="content">
        PHP 使用 Guzzle 发送 http 请求 
<p>Guzzle 是一个开源的 PHP HTTP 客户端，同时支持同步和异步方法。使用它可以轻松发送 GET、POST 请求，实现和第三方服务器的通信。</p>
<a id="more"></a>

<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>使用 Composer 安装依赖包。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require guzzlehttp&#x2F;guzzle</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>在控制器中新建一个 Client （HTTP 客户端）对象。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$client = <span class="keyword">new</span> \GuzzleHttp\Client();</span><br></pre></td></tr></table></figure>

<p>调用 Client 对象的 <code>request</code> 方法发送 HTTP 请求。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$res = $client-&gt;request(<span class="string">'get'</span>, <span class="string">'http://www.example.com'</span>);</span><br></pre></td></tr></table></figure>

<p>使用 <code>getBody</code> 等方法可以获取响应的内容。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取状态码</span></span><br><span class="line">$res-&gt;getStatusCode();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取头部信息</span></span><br><span class="line">$res-&gt;getHeaderLine(<span class="string">'content-type'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取打印内容</span></span><br><span class="line">$res-&gt;getBody();</span><br></pre></td></tr></table></figure>

<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>要在 GET 请求时传递参数，除了把参数直接写进链接，还可以把参数放到 <code>query</code> 数组中。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$client-&gt;request(<span class="string">'GET'</span>, <span class="string">'http://www.example.com'</span>, [</span><br><span class="line">  <span class="string">'query'</span> =&gt; [</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'hi@caiyiming.com'</span></span><br><span class="line">  ]</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p><code>form_params</code> 数组用于设置 POST 请求的参数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$client-&gt;request(<span class="string">'POST'</span>, <span class="string">'http://www.example.com'</span>, [</span><br><span class="line">  <span class="string">'form_params'</span> =&gt; [</span><br><span class="line">    <span class="string">'email'</span> =&gt; <span class="string">'hi@caiyiming.com'</span></span><br><span class="line">  ]</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="头部"><a href="#头部" class="headerlink" title="头部"></a>头部</h3><p><code>header</code> 数组用于设置 HTTP 请求的头部信息。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$client-&gt;request(<span class="string">'GET'</span>, <span class="string">'http://www.example.com'</span>, [</span><br><span class="line">  <span class="string">'headers'</span> =&gt; [</span><br><span class="line">    <span class="string">'User-Agent'</span> =&gt; <span class="string">'Mozilla/5.0'</span></span><br><span class="line">  ]</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h3><p><code>sendAsync</code> 方法用于发送异步请求，<code>then</code> 方法用于设置回调函数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$request = <span class="keyword">new</span> \GuzzleHttp\Psr7\Request(<span class="string">'GET'</span>, <span class="string">'http://www.example.com'</span>);</span><br><span class="line">$promise = $client-&gt;sendAsync($request)-&gt;then(<span class="function"><span class="keyword">function</span> <span class="params">($response)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 请求完成后的操作</span></span><br><span class="line">  $response-&gt;getBody();</span><br><span class="line">&#125;);</span><br><span class="line">$promise-&gt;wait();</span><br></pre></td></tr></table></figure>

<p>相关环境：Windows 7 x64 / VirtualBox 5.1.8 / Laravel Homestead / Lumen 5.3</p>
 
      </div>
    </div>
    <div class="foot">
      <div class="footer">
        <span class="copyright">©️2020 ym</span>
        <a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20041235 </a>
      </div>
    </div>
  </body>
</html>