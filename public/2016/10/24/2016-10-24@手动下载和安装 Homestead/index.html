<html>
  <head>
    <title>ym</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/app.css">
  <meta name="generator" content="Hexo 4.2.1"></head>
  <body>
    <div class="head">
      <div class="header">
        <a href="/ ">
          <div class="site-title">YM</div>
        </a>
      </div>
    </div>
    <div class="body">
      <div class="content">
        手动下载和安装 Homestead 
<p>在配置 Homestead 开发环境的过程中，执行以下命令将下载1G左右的镜像文件（Vagrant Box），然后安装包含完整 Homestead 环境的虚拟机。由于资源服务器位于海外，经常导致下载速度缓慢、下载失败等问题。</p>
<a id="more"></a>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant box add laravel&#x2F;homestead</span><br></pre></td></tr></table></figure>

<p>我们可在命令行中找到 <em>box: Downloading</em> 开头的一行，后面就是 Vagrant Box 文件的下载链接。将链接复制到迅雷等工具下载，得到拓展名为 box 的镜像文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vagrant box add laravel&#x2F;homestead</span><br><span class="line">&#x3D;&#x3D;&gt; box: Loading metadata for box &#39;laravel&#x2F;homestead&#39;</span><br><span class="line">...</span><br><span class="line">box: Downloading:  https:&#x2F;&#x2F;atlas.hashicorp.com&#x2F;laravel&#x2F;boxes&#x2F;homestead&#x2F;versions&#x2F;0.5.0&#x2F;providers&#x2F;virtualbox.box</span><br></pre></td></tr></table></figure>

<p>然后选择以下任意一种方式安装虚拟机。</p>
<h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>第一步，执行以下命令通过刚刚下载的镜像文件添加虚拟机。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Linux</span><br><span class="line">vagrant box add laravel&#x2F;homestead ~&#x2F;virtualbox.box</span><br><span class="line"></span><br><span class="line"># Windows</span><br><span class="line">vagrant box add laravel&#x2F;homestead file:&#x2F;&#x2F;&#x2F;d:&#x2F;virtualbox.box</span><br></pre></td></tr></table></figure>

<p>注意，此时通过 <code>vagrant up</code> 命令启动虚拟机时，仍会下载镜像文件。这是因为 Vagrant 认为该虚拟机的版本过低，于是自动下载最新版本的镜像（即使刚刚离线安装的虚拟机已是最新版）。</p>
<p>第二步，解决版本识别错误问题。只需修改 Vagant 的索引文件即可解决，该文件参考路径如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\YIMING\\.vagrant.d\data\machine-index\index</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;box&quot;:&#123;</span><br><span class="line">	&quot;name&quot;:&quot;laravel&#x2F;homestead&quot;,</span><br><span class="line">	&quot;provider&quot;:&quot;virtualbox&quot;,</span><br><span class="line">	&quot;version&quot;:&quot;0.5.0&quot;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该方法需目录下已存在 index 文件可供修改，或者你已经很熟悉这个文件的格式。index 文件以 JSON 格式存储着已（通过Vagrant）安装的虚拟机的信息。将 version 字段修改为可用的版本号即可，然后再次尝试 <code>vagrant up</code> 启动虚拟机。</p>
<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>第一步，执行 <code>vagrant box add laravel/homestead</code> 触发下载镜像文件，然后马上按 Ctrl+C 取消。</p>
<p>第二步，在 ~\.vagrant.d\tmp 目录下找到下载时生成的缓存文件。文件名类似：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">boxb1926d351572dd849646d59563156601f026e2a5</span><br></pre></td></tr></table></figure>

<p>第三步，将之前手动下载的镜像文件重命名为缓存文件的文件名，并覆盖缓存文件。</p>
<p>第四步，执行 <code>vagrant box add laravel/homestead</code> ，下载进度将直接显示为100%，并开始添加虚拟机。</p>
<p>简单总结一下。这两种方法都是我探索后发现的、退而求其次地安装 Homestead 虚拟机的方法。前者直接用命令通过本地镜像安装，但会出现 Vagrant 认错版本的尴尬（或许日后的版本更新可以修复）。后者则用本地镜像文件，替换掉缓存文件，欺骗 Vagrant 下载已完成从而执行安装。后者不需要纠正版本识别错误。</p>
<p>相关环境：Windows 10 x64 / VirtualBox 5.1.8 / Laravel Homestead</p>
 
      </div>
    </div>
    <div class="foot">
      <div class="footer">
        <span class="copyright">©️2020 ym</span>
        <a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20041235 </a>
      </div>
    </div>
  </body>
</html>