 
<html>
  <head>
    <title>记博客更换域名并迁移至 GitHub Pages</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <link rel="icon" href="/img/favicon.png">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2235676_71rm12z746w.css">
    <link rel="stylesheet" href="/libs/prism/prism.default.css">
    <link rel="stylesheet" href="/css/index.css">
  <meta name="generator" content="Hexo 5.2.0"></head>
  <body ontouchstart="">
    <div class="head">
  <div class="header">
    <div class="title">
      <a href="/"></a>ymcai</a>
    </div>
    <div class="menu">
      <a href="/">
        <span class="menu-item">首页</span>
      </a>
      <a href="/categories">
        <span class="menu-item">分类</span>
      </a>
      <a href="/about">
        <span class="menu-item">关于</span>
      </a>
    </div>
  </div>
</div>
    <div class="body">
  <div class="container">
     

<div class="post-header">
  <h1 class="post-title">记博客更换域名并迁移至 GitHub Pages</h1>
  <div class="post-meta">
    <span>2018-03-20</span>
    
      
      <a class="post-meta-category" href="/categories/categories/back-end">后端</a>
    
  </div>
</div>
<div class="post-body main-body">
  <p>最近在 Namecheap 注册了一个新域名 <code>yiming.blog</code> ，打算单独用于博客，替换掉原有的域名。无奈目前 <code>.blog</code> 域名无法在国内备案，只能考虑迁移到境外主机。为了避免不必要的资源浪费，我决定将其迁移到 GitHub Pages，并使用 CDN 提供 HTTPS 能力。</p>
<a id="more"></a>

<h3 id="部署代码"><a href="#部署代码" class="headerlink" title="部署代码"></a>部署代码</h3><p><a target="_blank" rel="noopener" href="https://pages.github.com/">GitHub Pages</a> 是 GitHub 提供的静态网页托管服务。相信不需要多余的笔墨介绍。只需创建一个名称为 <code>&#123;username&#125;.github.io</code> 的仓库并提交网页代码，然后在 <code>Settings</code> 中启用 GitHub Pages 即可上线你的个人静态网站。<code>&#123;username&#125;</code> 表示你的用户名。</p>
<h3 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a>绑定域名</h3><p>首先，登录域名注册商的后台修改 DNS 设置，添加一条 CNAME 记录，将主域名指向 <code>&#123;username&#125;.github.io</code> 。然后在代码仓库的根目录下新建一个 <code>CNAME</code> 文件，写入域名。这样就可以用独立域名访问你的网站了。需要注意的是，一个 GitHub Pages 仅支持绑定一个域名，即使 <code>CNAME</code> 文件中存在多个域名也只会匹配第一个。</p>
<h3 id="启用-HTTPS"><a href="#启用-HTTPS" class="headerlink" title="启用 HTTPS"></a>启用 HTTPS</h3><p>GitHub Pages 支持在使用默认二级域名 <code>&#123;username&#125;.github.io</code> 的情况下启用 HTTPS ，绑定独立域名则无法开启。于是我决定使用 <a target="_blank" rel="noopener" href="https://www.cloudflare.com/">Cloudflare</a> 的免费 DNS 服务为托管站点赋能 HTTPS 。</p>
<p>首选需要将域名交给 Cloudflare 解析，登录域名注册商的后台，修改域名的 NS 服务器：</p>
<pre class="line-numbers language-none"><code class="language-none">kiki.ns.cloudflare.com
ram.ns.cloudflare.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>别忘了在 Cloudflare 的控制面板中设置主域名的 CNAME 记录指向 <code>&#123;username&#125;.github.io</code> 。然后在 <code>Crypto</code> 标签页中将 SSL 状态设置为 <code>Flexible</code> 。这时候已经可以用 <code>https://&#123;你的域名&#125;</code> 访问站点了。</p>
<p>接下来，为了使所有的 <code>http</code> 访问都重定向到 <code>https</code> ，即禁用非安全链接访问，应该启用 <code>Always use HTTPS</code> 功能。或者在 <code>Page Rules</code> 标签页中设置两条 URL 规则：</p>
<pre class="line-numbers language-none"><code class="language-none">www.example.com&#x2F;*  Forwarding URL (301)  https:&#x2F;&#x2F;example.com&#x2F;$1
http:&#x2F;&#x2F;yiming.blog&#x2F;*  Always Use HTTPS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>一是将带 <code>www</code> 的二级域名永久重定向至主域名，有利于集中搜索引擎权重，二是始终使用 <code>https</code> 访问。</p>
<p>更新：</p>
<p>2018年5月1日，GitHub 宣布自定义域名支持 HTTPS，可以直接在 Pages 设置中启用。</p>
<h3 id="旧域名重定向"><a href="#旧域名重定向" class="headerlink" title="旧域名重定向"></a>旧域名重定向</h3><p>搜索引擎不会立刻知晓网站更换了域名，所以依然会有访问者打开旧的链接。为了不影响访问，同时通知搜索引擎更换收录的域名，需要将旧域名的链接全部 301 重定向到新域名。</p>
<p>假设旧域名为 <code>www.foo.com</code> ，新域名为 <code>bar.com</code> ，这是一个 Nginx 的配置示例：</p>
<pre class="line-numbers language-none"><code class="language-none">server &#123;
  listen 80;
  server_name www.foo.com;
  return 301 https:&#x2F;&#x2F;bar.com$request_uri;
&#125;
server &#123;
  listen 443;
  server_name www.foo.com;
  return 301 https:&#x2F;&#x2F;bar.com$request_uri;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>至此，域名更换与迁移大功告成。</p>

  
    <div class="post-tags">
    
      
      <a class="post-tag" href="/tags/SSL">SSL</a>
    
      
      <a class="post-tag" href="/tags/HTTPS">HTTPS</a>
    
      
      <a class="post-tag" href="/tags/GitHub-Pages">GitHub Pages</a>
    
      
      <a class="post-tag" href="/tags/CDN">CDN</a>
    
      
      <a class="post-tag" href="/tags/DNS">DNS</a>
    
  </div>
  
</div>
<div class="page-footer">
  <div class="page-footer-links">
    <a class="page-footer-link" href="javascript:history.back()">返回</a>
    
      <a class="page-footer-link" href="">
        下一篇：使用 Certbot 申请和部署 SSL 证书
      </a>
     
  </div>
</div>

  </div>
</div>
    <div class="foot">
  <div class="footer">
    <span class="copyright">©️2020 ymcai.xyz</span>
    <a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20041235 </a>
  </div>
</div>

<script type="text/javascript">
function wrapTables() {
  var nodes = document.body.querySelectorAll('table');
  for (var i = 0; i < nodes.length; i++) {
    var table = nodes[i];
    var wrapEl = document.createElement('div');
    wrapEl.className = 'table-wrap';
    table.parentNode.replaceChild(wrapEl, table);
    wrapEl.appendChild(table)
  }
};
wrapTables();
</script>
  </body>
</html>