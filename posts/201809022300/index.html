 
<html build-time="2020-12-01 00:19">
  <head>
    <title>Laravel 快速入门</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <link rel="icon" href="/img/favicon.png">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2235676_71rm12z746w.css">
    <link rel="stylesheet" href="/libs/prism/prism.default.css">
    <link rel="stylesheet" href="/css/index.css?t=202012010019">
  <meta name="generator" content="Hexo 5.2.0"></head>
  <body ontouchstart="">
    <div class="head">
  <div class="header">
    <div class="title">
      <a href="/"></a>ymcai</a>
    </div>
    <div class="menu">
      <a href="/">
        <span class="menu-item">首页</span>
      </a>
      <a href="/categories">
        <span class="menu-item">分类</span>
      </a>
      <a href="/about">
        <span class="menu-item">关于</span>
      </a>
    </div>
  </div>
</div>
    <div class="body">
  <div class="container">
     

<div class="post-header">
  <h1 class="post-title">Laravel 快速入门</h1>
  <div class="post-meta">
    <span>2018-09-02</span>
    
      
      <a class="post-meta-category" href="/categories/categories/back-end">后端</a>
    
  </div>
</div>
<div class="post-body main-body">
  <p>上周我在团队内做了 Laravel 入门分享，希望能够帮助对这款框架不熟悉的同学快速上手，最好听完就能撸个接口。作为前端小哥的我自知对后端了解有限，于是我事先写了个 demo，围绕一个假定的需求 —— 学生信息的增删改查来讲这堂课。</p>
<a id="more"></a>

<p>这篇文章假设读者已经掌握 Laravel 的安装，若不了解请先移步 <a target="_blank" rel="noopener" href="https://laravel.com/docs/5.6#installation">文档</a> 。</p>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h3 id="迁移"><a href="#迁移" class="headerlink" title="迁移"></a>迁移</h3><p>首先我们要建一个班级表和一个学生表。Laravel 提供了迁移（migration）功能用于创建和更新数据表。</p>
<p>简单地说，我们把表结构用编程的方式写在文件中，然后执行这些文件，达到建表和更新表结构的目的。每个迁移文件都包含一个 <code>up</code> 方法和一个 <code>down</code> 方法，分别用于执行和回滚迁移。</p>
<p>在 CLI 执行以下命令创建两张表的迁移文件：</p>
<pre class="line-numbers language-none"><code class="language-none">php artisan make:migration create_classes_table
php artisan make:migration create_students_table<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>此时可在 <code>database/migrations</code> 目录下找到新增的 2 个迁移文件。</p>
<p>我们先来看看 <code>classes</code> 表的迁移文件，Laravel 已经帮我们写了一些代码。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'classes'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Blueprint <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">increments</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建一个自增的 id 字段</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 创建 created_at 和 updated_at 字段</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>我增加了一个 <code> name</code> 字段，用来保存班级名称。实际上，这句代码在数据库中创建的是一个 varchar 类型，最大长度 16 个字符的字段。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">string</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>接下来编辑 students 表的迁移文件：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'students'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Blueprint <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">increments</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">string</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'number'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 学生编号</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">string</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 学生姓名</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">tinyInteger</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'class_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 班级 ID</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">softDeletes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 创建 deleted_at 字段</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后在 CLI 中执行 <code>php artisan migrate</code> 运行迁移，数据库中便创建了 <code>classes</code>、<code>students</code>、<code>migrations</code> 等表。</p>
<p><code>migrations</code> 表用于记录执行过哪些迁移。</p>
<p><code>created_at</code> 和 <code>updated_at</code> 字段分别用于存储创建时间和更新时间。当使用 Eloquent ORM 方式修改数据时，它们将自动更新。</p>
<p><code>deleted_at</code> 字段用于软删除数据，即记录不会真的从数据库中删除，而是存储一个删除时间，这些数据便不会再被查询出来。</p>
<h3 id="填充"><a href="#填充" class="headerlink" title="填充"></a>填充</h3><p>有时候我们希望给数据表批量写入一些数据。例如，在建完 <code>classes</code> 表后将已知的所有班级信息插入到表中。Laravel 提供了填充（seed）功能用于填充测试数据。</p>
<p>在 CLI 执行以下命令创建一个填充器。</p>
<pre class="line-numbers language-none"><code class="language-none">php artisan make:seeder ClassesTableSeeder<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>编辑 <code>database/seeds</code> 目录下新增的 <code>ClassesTableSeeder.php</code> ，在 <code>run</code> 方法中插入代码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'classes'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'三年一班'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'classes'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'三年二班'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'classes'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'三年三班'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>执行以下命令运行填充器：</p>
<pre class="line-numbers language-none"><code class="language-none">php artisan db:seed --class&#x3D;ClassesTableSeeder<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后便可以在 classes 表中看见刚刚填充进去的 3 个班级。</p>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>API 路由应该在 <code>route/api.php</code> 中声明，Route 类提供了 <code>get/post/patch/delete</code> 等路由方法用于定义不同类型的路由。</p>
<p>我们先定义一个简单的路由：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'hello'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">input</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// 获取请求参数</span>
    <span class="token keyword">return</span> <span class="token double-quoted-string string">"Hello Laravel, I am <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$name</span><span class="token punctuation">&#125;</span></span> !"</span><span class="token punctuation">;</span>  <span class="token comment">// 响应字符串内容</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后我们访问 <code>http://&#123;你的域名&#125;/api/hello?name=YIMING</code>，浏览器将显示：</p>
<pre class="line-numbers language-none"><code class="language-none">Hello Laravel, I am YIMING !<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>通过这个 Hello World 路由可以知道，路由方法的第一个参数是 URI ，第二个参数是一个 callback 。</p>
<p>URI 中可以使用 <code>&#123;&#125;</code> 声明路由参数，并在回调函数中使用：</p>
<pre class="line-numbers language-none"><code class="language-none">Route::get(&#39;hello&#x2F;&#123;name&#125;&#39;, function ($name) &#123;
    return &quot;Hello Laravel, I am &#123;$name&#125; !&quot;;
&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>路由也可以指向某个控制器动作（方法）：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'students'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'StudentController@index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'students'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'StudentController@store'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'students/&#123;student&#125;'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'StudentController@show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'students/&#123;student&#125;'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'StudentController@update'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'students/&#123;student&#125;'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'StudentController@destory'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果控制器是一个符合要求的 RESTful 资源控制器（见下文），上面这些路由等价于。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">resource</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'students'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'StudentController'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p>Laravel 提供了 Eloquent ORM（对象关系映射），一个模型对应一张数据表，通过模型类操作数据表。模型文件默认放在 <code>app</code> 目录下。 </p>
<p>举个例子，假设存在 <code>User</code> 模型，那么它将默认对应数据库中的 <code>users</code> 表，我们可以这样查询数据：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 查询 id 等于1的用户</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>执行以下命令分别为班级表、学生表创建模型：</p>
<pre class="line-numbers language-none"><code class="language-none">php artisan make:model StudentClass
php artisan make:model Student<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>Student</code> 模型默认对应 <code>students</code> 表。</p>
<p>对于  <code>StudentClass</code> 模型，我们可以显式地声明它的关联表为 <code>classes</code> ：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">StudentClass</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span> <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'classes'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后编辑 <code>Student</code> 模型：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>SoftDeletes</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// 启用软删除</span>
    <span class="token keyword">use</span> <span class="token package">SoftDeletes</span><span class="token punctuation">;</span>
    <span class="token comment">// 可被批量赋值的字段</span>
    <span class="token keyword">protected</span> <span class="token variable">$fillable</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'number'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'class_id'</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 与班级表的关联关系</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> studentClass <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">hasOne</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'App\StudentClass'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'id'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'class_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p>在路由小节中，我们注册了一个指向 <code>StudentController</code> 控制器的资源路由。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php">Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">resource</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'students'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'StudentController'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>执行以下命令创建 <code>StudentController</code> 控制器：</p>
<pre class="line-numbers language-none"><code class="language-none">php artisan make:controller StudentController <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>由于 <code>StudentController</code> 是一个资源控制器，下列请求将自动指向相应控制器方法。</p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>URI</th>
<th>控制器方法</th>
<th>操作</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>/api/students</td>
<td>index</td>
<td>查询全部</td>
</tr>
<tr>
<td>GET</td>
<td>/api/students/{student}</td>
<td>show</td>
<td>查询单条</td>
</tr>
<tr>
<td>POST</td>
<td>/api/students</td>
<td>store</td>
<td>创建</td>
</tr>
<tr>
<td>PATCH</td>
<td>/api/students/{student}</td>
<td>update</td>
<td>修改</td>
</tr>
<tr>
<td>DELETE</td>
<td>/api/students/{student}</td>
<td>destroy</td>
<td>删除</td>
</tr>
</tbody></table>
<p>首先，在控制器中导入 Request、Validator 和 Student 模型：</p>
<pre class="line-numbers language-none"><code class="language-none">use Illuminate\Http\Request;
use Validator;
use App\Student;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>请求类（Request）用于获取参数，验证类（Validator）用于验证参数的合法性，Student 模型用于 <code>students</code> 表的增删改查操作。</p>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p><code>index</code> 方法使用模型查询数据表，然后返回学生列表：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> index <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// 查询全部记录</span>
    <span class="token keyword">return</span> Student<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 查询三年一班的学生</span>
    <span class="token keyword">return</span> Student<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'class_id'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'1'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 查询前两个班的学生</span>
    <span class="token keyword">return</span> Student<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'class_id'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&lt;='</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'2'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 包含软删除的记录</span>
    <span class="token keyword">return</span> Student<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 分页 每页15条记录</span>
    <span class="token keyword">return</span> Student<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 同时查询关联数据</span>
    <span class="token keyword">return</span> Student<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'studentClass'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>启用分页时，返回的结果中会包含页码、总页数等数据。</p>
<p>在请求时传递  <code>page</code>  可以查询指定页码的数据，否则默认返回第一页。</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;api&#x2F;students?page&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>由于在 Student 模型中声明了和 StudentClass 模型（即班级表）的关联关系，我们可以使用 <code>with</code> 同时查出学生的班级信息。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
    number<span class="token operator">:</span> <span class="token string">'2018090201'</span>
    name<span class="token operator">:</span> <span class="token string">'张三'</span>，
    <span class="token operator">...</span>
    studentClass<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">'三年一班'</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>show</code> 方法接收一个路由参数，返回指定 id 的学生：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> show <span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> Student<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h3><p><code>store</code> 方法接收用户输入，验证参数的合法性，然后创建一名学生。这里不再赘述验证（Validation）功能的用法，感兴趣的同学可以移步官方文档了解。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> store <span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// 验证器</span>
    <span class="token variable">$validator</span> <span class="token operator">=</span> Validator<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token comment">// 必填，在 students 表中唯一，不多于10个字符。</span>
        <span class="token single-quoted-string string">'number'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'required|unique:students|max:10'</span><span class="token punctuation">,</span>
        <span class="token comment">// 必填，不多于8个字符。</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'required|max:8'</span><span class="token punctuation">,</span>
        <span class="token comment">// 必填，只能是1、2或3。</span>
        <span class="token single-quoted-string string">'class_id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'required|in:1,2,3'</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2</span><span class="token comment">// 当验证失败时响应 422 错误</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$validator</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token variable">$validator</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">422</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> Student<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><p><code>update</code> 方法接收用户输入和路由参数（学生 id），然后更新相应学生的信息。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> update <span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    Student<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p><code>destroy</code> 方法接收一个路由参数（学生 id），然后删除相应的学生。由于模型中启用了软删除，不会真的从数据表中删除记录，而是更新其 <code>deleted_at</code> 字段。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> destory <span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    Student<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>你可以在 Postman 中调试一下这几个接口了，happy hacking ！</p>
<p>相关链接：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://laravel.com/docs/5.6">Laravel 5.6 官方文档</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://laravelacademy.org/laravel-docs-5_6">Laravel 5.6 中文文档</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/ymcn/laravel-demo">本文中的 demo 代码</a></p>
</li>
</ul>
<p>相关环境：macOS 10.13 / Laravel Homestead / Laravel 5.6</p>

  
    <div class="post-tags">
    
      
      <a class="post-tag" href="/tags/PHP">PHP</a>
    
      
      <a class="post-tag" href="/tags/Laravel">Laravel</a>
    
  </div>
  
</div>
<div class="page-footer">
  <div class="page-footer-links">
    <a class="page-footer-link" href="javascript:history.back()">返回</a>
    
      <a class="page-footer-link" href="">
        下一篇：如何优雅地和译者协作开发多语言 WebApp
      </a>
     
  </div>
</div>

  </div>
</div>
    <div class="foot">
  <div class="footer">
    <span class="copyright">©️2020 ymcai.xyz</span>
    <a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20041235 </a>
  </div>
</div>

<script type="text/javascript">
function wrapTables() {
  var nodes = document.body.querySelectorAll('table');
  for (var i = 0; i < nodes.length; i++) {
    var table = nodes[i];
    var wrapEl = document.createElement('div');
    wrapEl.className = 'table-wrap';
    table.parentNode.replaceChild(wrapEl, table);
    wrapEl.appendChild(table)
  }
};
wrapTables();
</script>
  </body>
</html>