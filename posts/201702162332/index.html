 
<html build-time="2020-12-01 00:19">
  <head>
    <title>使用 Laravel Excel 导入导出 Excel & CSV</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <link rel="icon" href="/img/favicon.png">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2235676_71rm12z746w.css">
    <link rel="stylesheet" href="/libs/prism/prism.default.css">
    <link rel="stylesheet" href="/css/index.css?t=202012010019">
  <meta name="generator" content="Hexo 5.2.0"></head>
  <body ontouchstart="">
    <div class="head">
  <div class="header">
    <div class="title">
      <a href="/"></a>ymcai</a>
    </div>
    <div class="menu">
      <a href="/">
        <span class="menu-item">首页</span>
      </a>
      <a href="/categories">
        <span class="menu-item">分类</span>
      </a>
      <a href="/about">
        <span class="menu-item">关于</span>
      </a>
    </div>
  </div>
</div>
    <div class="body">
  <div class="container">
     

<div class="post-header">
  <h1 class="post-title">使用 Laravel Excel 导入导出 Excel & CSV</h1>
  <div class="post-meta">
    <span>2017-02-16</span>
    
      
      <a class="post-meta-category" href="/categories/categories/back-end">后端</a>
    
  </div>
</div>
<div class="post-body main-body">
  <p>Laravel Excel 是一个开源库，使用它可以很轻易地在 Laravel 项目上实现导入和导出 Excel、CSV 文件。Laravel Excel 基于另一个开源项目 PHPExcel ，所以如果你的应用不是运行在 Laravel 上， 你也可以尝试使用 PHPExcel 。</p>
<a id="more"></a>

<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>在 composer.json 中添加相应的包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token string">"maatwebsite/excel"</span><span class="token operator">:</span> <span class="token string">"~2.1.0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后在命令行执行以下代码安装 Laravel Excel 。</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">composer update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>修改 Laravel 的配置文件 config/app.php ，在 $providers 数组中添加一个服务提供者。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token single-quoted-string string">'Maatwebsite\Excel\ExcelServiceProvider'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>接着在 $aliasses 数组中添加一个门面。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token single-quoted-string string">'Excel'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'Maatwebsite\Excel\Facades\Excel'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>如果你想要查看或者修改 Laravel Excel 提供的配置，在命令行执行以下代码，然后你就会在 config 文件夹下得到一个配置文件。</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">php artisan vendor:publish<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>在控制器中引用这个包。如果之前已经添加过门面，也可以直接引用门面。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">use</span> <span class="token package">Maatwebsite<span class="token punctuation">\</span>Excel<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Excel</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">use</span> <span class="token package">Excel</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// 加载文件</span>
Excel<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'file.xls'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$reader</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token comment">// 获取数据的集合</span>
  <span class="token variable">$results</span> <span class="token operator">=</span> <span class="token variable">$reader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取第一行数据</span>
  <span class="token variable">$results</span> <span class="token operator">=</span> <span class="token variable">$reader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取前10行数据</span>
  <span class="token variable">$reader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 跳过前10行数据</span>
  <span class="token variable">$reader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 以数组形式获取数据</span>
  <span class="token variable">$reader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 打印数据</span>
  <span class="token variable">$reader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 遍历工作表</span>
  <span class="token variable">$reader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$sheet</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// 遍历行</span>
    <span class="token variable">$sheet</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取指定的列</span>
  <span class="token variable">$reader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'firstname'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'lastname'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取指定的列</span>
  <span class="token variable">$reader</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'firstname'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'lastname'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 选择名为sheet1的工作表</span>
Excel<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">selectSheets</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'sheet1'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 根据索引选择工作表</span>
Excel<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">selectSheetsByIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// 生成文件</span>
Excel<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Filename'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$excel</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token comment">// 设置文档标题和作者</span>
  <span class="token variable">$excel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Our new awesome title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$excel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setCreator</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Maatwebsite'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">></span><span class="token function">setCompany</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Maatwebsite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 设置文档描述</span>
  <span class="token variable">$excel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'A demonstration to change the file properties'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 创建工作表</span>
  <span class="token variable">$excel</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">sheet</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Sheetname'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$sheet</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// 通过数组写入值（二维数组）</span>
    <span class="token variable">$sheet</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fromArray</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 给第一行写入值（一维数组）</span>
    <span class="token variable">$sheet</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">row</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置某一列的宽</span>
    <span class="token variable">$sheet</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'A'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 批量设置列宽</span>
    <span class="token variable">$sheet</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'A'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'B'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">10</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 生成为指定的格式并下载</span>
Excel<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">export</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'xls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 生成为指定的格式并存储在app/storage/exports目录</span>
Excel<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">store</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'xls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 生成为指定的格式并存储在指定的目录</span>
Excel<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">store</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'xls'</span><span class="token punctuation">,</span> <span class="token function">storage_path</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'excel/exports'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 存储后返回文件数据（包含路径等）</span>
Excel<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">store</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'xls'</span><span class="token punctuation">,</span> <span class="token boolean constant">false</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Laravel Excel 还提供了很多包含表格样式修改在内的其他 API 。感兴趣的话可以阅读 <a target="_blank" rel="noopener" href="http://www.maatwebsite.nl/laravel-excel/docs">官方文档</a> 了解。</p>
<p>相关环境：Windows 7 x64 / VirtualBox 5.1.8 / Laravel Homestead / Laravel 5.3</p>

  
    <div class="post-tags">
    
      
      <a class="post-tag" href="/tags/PHP">PHP</a>
    
      
      <a class="post-tag" href="/tags/Laravel">Laravel</a>
    
  </div>
  
</div>
<div class="page-footer">
  <div class="page-footer-links">
    <a class="page-footer-link" href="javascript:history.back()">返回</a>
    
      <a class="page-footer-link" href="">
        下一篇：使用 Intervention Image 库处理图片
      </a>
     
  </div>
</div>

  </div>
</div>
    <div class="foot">
  <div class="footer">
    <span class="copyright">©️2020 ymcai.xyz</span>
    <a href="http://www.beian.miit.gov.cn" target="_blank">粤ICP备20041235 </a>
  </div>
</div>

<script type="text/javascript">
function wrapTables() {
  var nodes = document.body.querySelectorAll('table');
  for (var i = 0; i < nodes.length; i++) {
    var table = nodes[i];
    var wrapEl = document.createElement('div');
    wrapEl.className = 'table-wrap';
    table.parentNode.replaceChild(wrapEl, table);
    wrapEl.appendChild(table)
  }
};
wrapTables();
</script>
  </body>
</html>